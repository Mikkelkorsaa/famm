@inject IConferenceService conferenceService
@page "/conference"
@inject NavigationManager navigationmanager
@inject IAuthService AuthService

<h3>ConferencePage</h3>
<button type="button" class="btn btn-primary w-50 btn-sm" @onclick="createConference">Opret konferencer</button>

@if (showModal)
{
    <ModalComponent OnClose="() => showModal = false">
        <CreateConferenceComponent OnSave="HandleSave" />
    </ModalComponent>
}
<button type="button" class="btn btn-primary w-50 btn-sm" @onclick="editConferences">Vis active konferencer</button>

@if (conferences.Count() > 0){
    <ConfrenceTableComponent conferences="@conferences"/>
}

@code {
    private bool showModal = false;
    private IEnumerable<Conference> conferences = new List<Conference>();

    protected override async Task OnInitializedAsync()
    {
        var CurrentUser = await AuthService.GetCurrentUser();
        if (CurrentUser is null)
            navigationmanager.NavigateTo("/login");
        else if (CurrentUser.Role.ToString() != "Organizer" && CurrentUser.Role.ToString() != "Admin")
            navigationmanager.NavigateTo("/dashboard");
        
    }

    private void createConference()
    {
        showModal = true;
        StateHasChanged();
        Console.WriteLine($"{showModal}");
    }

    private async Task editConferences()
    {
        conferences = await conferenceService.GetActiveConferencesAsync();
    }

    private void HandleSave(Conference conference)
    {
        showModal = false;
        StateHasChanged();
    }
}